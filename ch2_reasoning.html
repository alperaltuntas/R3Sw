
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chapter 2: Reasoning About Code &#8212; Rigor and Reasoning in Research Software (R3Sw)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-V7VKREZ5MB"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-V7VKREZ5MB');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-V7VKREZ5MB');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch2_reasoning';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 3: Unit Testing" href="ch3_unit_testing.html" />
    <link rel="prev" title="Chapter 1: Code and Fix" href="ch1_code_and_fix.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="welcome.html">
  
  
  
  
  
  
    <p class="title logo__title">Rigor and Reasoning in Research Software (R3Sw)</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="welcome.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1_code_and_fix.html">Chapter 1: Code and Fix</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 2: Reasoning About Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch3_unit_testing.html">Chapter 3: Unit Testing</a></li>

<li class="toctree-l1"><a class="reference internal" href="ch4_property_based_testing.html">Chapter 4: Property-Based Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5_theorem_proving.html">Chapter 5: Theorem Proving</a></li>
<li class="toctree-l1"><a class="reference internal" href="closing_remarks.html">Closing Remarks: Climbing the Ladder of Rigor</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ch2_reasoning.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 2: Reasoning About Code</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstraction">1. Abstraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-abstraction-vs-procedural-abstraction">Data Abstraction vs. Procedural Abstraction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition">2. Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specification-writing-down-intent">3. Specification: Writing Down Intent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-example">A simple example:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-1">Exercise 2.1:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-writing-code-that-meets-specifications">4. Implementation: Writing Code that Meets Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heat-equation-solver-revisited">Heat Equation Solver, Revisited</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-abstraction">Step 1 — Abstraction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-decomposition">Step 2 – Decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-structures">Data Structures:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#procedures">Procedures:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-specification">Step 3 – Specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-2">Exercise 2.2:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-3">Exercise 2.3:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-implementation">Step 4 – Implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-just-did">What we just did</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#looking-ahead">Looking Ahead</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-2-reasoning-about-code">
<h1>Chapter 2: Reasoning About Code<a class="headerlink" href="#chapter-2-reasoning-about-code" title="Link to this heading">#</a></h1>
<p>In Chapter 1, we implemented a working 1-D heat equation solver.
It runs, but it’s fragile, opaque, and hard to test or extend.</p>
<p>This resembles a common situation in scientific computing:</p>
<ul class="simple">
<li><p>write some code, see if it runs, fix what breaks, repeat.</p></li>
<li><p>It gets results quickly, but the codebase becomes harder to understand and maintain over time.</p></li>
</ul>
<p>In this chapter, we ask: can we design our code systematically, in a way that allows us to reason about it before we even run it?</p>
<p>To achieve this, we need to manage complexity by breaking the problem into smaller pieces.</p>
<p>But how do we decide how to break a problem into pieces?</p>
<ul class="simple">
<li><p>We can use abstraction to identify the key concepts in our problem, and then use those abstractions to guide our decomposition.</p></li>
<li><p>Once we have a decomposition, we can write specifications for each piece, i.e., precise and testable descriptions of what each piece should do.</p></li>
</ul>
<p>The process of designing software in this way can be summarized in four steps:</p>
<ol class="arabic simple">
<li><p><strong>Abstraction:</strong> determine the concepts that matter.</p></li>
<li><p><strong>Decomposition:</strong> Based on our abstractions, break the problem into smaller pieces.</p></li>
<li><p><strong>Specification:</strong> For each piece, write down what it should do, in a way that’s precise and testable.</p></li>
<li><p><strong>Implementation:</strong> Write code that meets the specifications.</p></li>
</ol>
<p><em>Note: This kind of design process is common in traditional software engineering, but it’s not often followed in scientific computing. The pioneers and advocates of this and similar approaches include <a class="reference external" href="https://en.wikipedia.org/wiki/Barbara_Liskov">Barbara Liskov</a>,…</em></p>
<section id="abstraction">
<h2>1. Abstraction<a class="headerlink" href="#abstraction" title="Link to this heading">#</a></h2>
<p>In software design, <strong>abstraction</strong> is the first and most important step. Here, we form a high-level architecture for our system:</p>
<ul class="simple">
<li><p>determine high-level concepts that matter.</p></li>
<li><p>ignore irrelevant details.</p></li>
</ul>
<p>This is a creative step, where we explore different ways to represent the system and its components.</p>
<p>In scientific computing, this step isn’t given enough attention, but it is crucial:</p>
<blockquote>
<div><p>What matters is the fundamental structure of the design. If you get
it wrong, there is no amount of bug fixing and refactoring that will
produce a reliable, maintainable, and usable system
<em>- D. Jackson. The essence of software. (2021)</em></p>
</div></blockquote>
<p>As scientists and engineers, we are already accustomed to abstraction: we model complex systems by removing unnecessary details and breaking problems into components.</p>
<p><img alt="Abstraction" src="_images/esm.png" /></p>
<p><strong>A natural concern:</strong> Aren’t most bugs caused by subtle low-level issues?</p>
<p>Yes, but many “low-level” bugs are symptoms of unclear high-level intent. When top-level responsibilities are muddled, they trickle down into brittle, error-prone implementations.
Abstraction pays off by:</p>
<ul class="simple">
<li><p>clarifying intent</p></li>
<li><p>making low-level details easier to manage.</p></li>
</ul>
<section id="data-abstraction-vs-procedural-abstraction">
<h3>Data Abstraction vs. Procedural Abstraction<a class="headerlink" href="#data-abstraction-vs-procedural-abstraction" title="Link to this heading">#</a></h3>
<p>In software design, there are two main forms of abstraction:</p>
<ul class="simple">
<li><p><strong>Data Abstraction</strong>: defining data structures that encapsulate state and behavior.</p></li>
<li><p><strong>Procedural Abstraction</strong>: defining procedures (functions, methods) that encapsulate behavior.</p></li>
</ul>
<p>For our running example, we will use procedural abstraction, since that’s simpler and more appropriate for a small solver like the 1-D heat equation.</p>
<p>For larger and more sophisticated applications, data abstraction (e.g., object-oriented programming) may be more appropriate. However, the fundamental principles of reasoning apply equally well to both.</p>
</section>
</section>
<section id="decomposition">
<h2>2. Decomposition<a class="headerlink" href="#decomposition" title="Link to this heading">#</a></h2>
<p>If abstraction helps us decide what matters, decomposition helps us decide how to organize it.</p>
<p>We want decomposition to:</p>
<ul class="simple">
<li><p>Isolate concerns and manage complexity</p></li>
<li><p>Facilitate testing and reasoning</p></li>
<li><p>Improve maintainability and extensibility</p></li>
</ul>
<p>Forms of decomposition include functions/methods (procedures), classes, and modules.</p>
<p>In the case of procedural abstraction, guiding principles in breaking a computation into procedures are:</p>
<ul>
<li><p>Each procedure should have a single, well-defined purpose.</p></li>
<li><p>Procedures should be general: avoid hard-coding specific values or assumptions.</p></li>
<li><p>Each procedure should be as simple as possible, but no simpler:</p>
<blockquote>
<div><p>“A good check for simplicity is to give the procedure a name that describes its purpose.
If it is difficult to think of a name, there may be a problem with the procedure.” -Liskov</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="specification-writing-down-intent">
<h2>3. Specification: Writing Down Intent<a class="headerlink" href="#specification-writing-down-intent" title="Link to this heading">#</a></h2>
<p>Once we have pieces, we need to say what each one should do.</p>
<p>A <em>specification</em> is a precise statement of what software should do, independent of how it does it.</p>
<p>Specifications can range from informal descriptions in plain English
to fully formal mathematical models.</p>
<p>In this tutorial, we’ll use a <strong>lightweight, practical level</strong> of specification that combines:</p>
<ul class="simple">
<li><p><strong>type annotations</strong> (for inputs and outputs),</p></li>
<li><p><strong>assertions</strong> that serve as contracts, i.e., preconditions and postconditions.</p></li>
</ul>
<p>This lightweight approach:</p>
<ul class="simple">
<li><p>Guides implementation,</p></li>
<li><p>Facilitates testing and validation.</p></li>
<li><p>Embeds reasoning directly into the program.</p></li>
</ul>
</section>
<section id="a-simple-example">
<h2>A simple example:<a class="headerlink" href="#a-simple-example" title="Link to this heading">#</a></h2>
<p>Below simple function exemplifies our practical approach to specification:</p>
<ul class="simple">
<li><p>Type annotations specify that <code class="docutils literal notranslate"><span class="pre">div</span></code> takes two floats and returns a float.</p></li>
<li><p>The first <code class="docutils literal notranslate"><span class="pre">assert</span></code> is a precondition (P): it specifies what must be true before the function is called.</p></li>
<li><p>The second <code class="docutils literal notranslate"><span class="pre">assert</span></code> is a postcondition (Q): it specifies what must be true after the function is called.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">div</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="c1"># Type annotations for inputs and output</span>
    <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>           <span class="c1"># P    (precondition)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>             <span class="c1"># code (implementation)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span>     <span class="c1"># Q    (postcondition)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">div</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.0
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong> Historically, preconditions and postconditions are often denoted <code class="docutils literal notranslate"><span class="pre">P</span></code> and <code class="docutils literal notranslate"><span class="pre">Q</span></code>, respectively, as in <em>Hoare logic</em>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{P} C {Q}
</pre></div>
</div>
<p>where C is a command (procedure).</p>
<p><strong>Note:</strong> Executable assertions as specifications is not universally loved.
Some prefer to keep specifications as comments or separate documents.
However, embedding specifications as executable assertions enables runtime checking and testing,
something we’ll utilize in the remaining chapters. Assertions can be disabled in production code,
e.g., via <code class="docutils literal notranslate"><span class="pre">-O</span></code> flag in Python, if performance is critical.</p>
</section>
<section id="exercise-2-1">
<h2>Exercise 2.1:<a class="headerlink" href="#exercise-2-1" title="Link to this heading">#</a></h2>
<p>Can you find inputs to <code class="docutils literal notranslate"><span class="pre">f</span></code> where this function fails the postcondition even when the precondition is satisfied?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">div</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p><strong>Answer:</strong> One possible input is <code class="docutils literal notranslate"><span class="pre">f(7,</span> <span class="pre">25)</span></code>. The precondition <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">!=</span> <span class="pre">0</span></code> is satisfied, but the postcondition <code class="docutils literal notranslate"><span class="pre">res</span> <span class="pre">*</span> <span class="pre">y</span> <span class="pre">==</span> <span class="pre">x</span></code> fails because due to floating-point rounding error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

<span class="nn">Cell In[1], line 4,</span> in <span class="ni">div</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>           <span class="c1"># P    (precondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>             <span class="c1"># code (implementation)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span>     <span class="c1"># Q    (postcondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">return</span> <span class="n">res</span>

<span class="ne">AssertionError</span>: 
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong> Floating-point arithmetic introduces unavoidable rounding errors.
These aren’t bugs, but natural computational artifacts. We can <em>weaken</em> the postcondition
to account for this by using approximate equality. We can do so using <code class="docutils literal notranslate"><span class="pre">pytest.approx</span></code> (or, similarly, <code class="docutils literal notranslate"><span class="pre">math.isclose</span></code>, <code class="docutils literal notranslate"><span class="pre">numpy.isclose</span></code>, etc.):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytest</span><span class="w"> </span><span class="kn">import</span> <span class="n">approx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">div</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="c1"># Type annotations for inputs and output</span>
    <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>               <span class="c1"># P    (precondition)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>                 <span class="c1"># code (implementation)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># Q    (postcondition)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.28
</pre></div>
</div>
</div>
</div>
<p><strong>Takeaway</strong>: Postconditions should reflect computational realities (e.g., floating-point).</p>
<p><strong>Preconditions deserve similar care.</strong></p>
<p><strong>weakest precondition</strong> :
the <em>most general condition</em> under which the code
works correctly. It ensures your function is usable in the widest range of scenarios
while still preventing incorrect behavior.</p>
<p>Conversely, we want the <strong>strongest postcondition</strong> possible: the most precise guarantee
about the outcome. This balance maximizes both the flexibility and reliability of our code.</p>
</section>
<section id="implementation-writing-code-that-meets-specifications">
<h2>4. Implementation: Writing Code that Meets Specifications<a class="headerlink" href="#implementation-writing-code-that-meets-specifications" title="Link to this heading">#</a></h2>
<p>With abstractions identified, pieces decomposed, and specifications written, we can implement code that satisfies them.</p>
<p>This shifts our mindset: instead of starting with lines of code and hoping they work, we start with clear expectations and then fill in implementations that must meet them.</p>
<p>We can then use testing and verification to ensure our implementations meet their specifications instantly.</p>
</section>
<section id="heat-equation-solver-revisited">
<h2>Heat Equation Solver, Revisited<a class="headerlink" href="#heat-equation-solver-revisited" title="Link to this heading">#</a></h2>
<p>In Chapter 1, we wrote a quick, monolithic solver for the 1-D heat equation.
It worked, but it mixed boundary conditions, flux calculations, and time-stepping into a single opaque function.</p>
<p>Now we’ll redesign it systematically, using the four-step process:</p>
<p>Abstraction → Decomposition → Specification → Implementation.</p>
<section id="step-1-abstraction">
<h3>Step 1 — Abstraction<a class="headerlink" href="#step-1-abstraction" title="Link to this heading">#</a></h3>
<p>At this stage, we define the <em>what</em> of our problem, i.e., the key concepts we need to model:</p>
<ul class="simple">
<li><p>We want to advance a 1-D temperature field <span class="math notranslate nohighlight">\(u_i\)</span> on a uniform grid using a conservative finite volume method:</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(
\qquad
u_i^{n+1} = u_i^{n} + \Delta t \times \, div(F_i),
\qquad
div(F_i) = \frac{F_{i} - F_{i+1}}{\Delta x},
\qquad
F_i =
\begin{cases}
q_L &amp; i = 0, \\[6pt]
-\kappa \dfrac{u_i - u_{i-1}}{\Delta x} &amp; 1 \leq i \leq N-1, \\[10pt]
q_R &amp; i = N.
\end{cases}
\)</span></p>
<p>The key concepts we need are:</p>
<ul class="simple">
<li><p>Mesh: describes the geometry of the domain (dx, number of cells).</p></li>
<li><p>Cell fields (u, dudt): quantities stored at cell centers.</p></li>
<li><p>Face fields (F): quantities stored at cell faces.</p></li>
<li><p>Procedures to perform the time-stepping of the heat equation.</p></li>
</ul>
<p>These abstractions are all we need to model the system.</p>
</section>
<section id="step-2-decomposition">
<h3>Step 2 – Decomposition<a class="headerlink" href="#step-2-decomposition" title="Link to this heading">#</a></h3>
<p>Based on our abstractions, we can break the solver into smaller pieces. Since we’ll use procedural abstraction, our focus is on defining functions that carry out the computations. But first, let’s determine the key data structures that we’ll need:</p>
<section id="data-structures">
<h4>Data Structures:<a class="headerlink" href="#data-structures" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><em>mesh</em>: discrete representation of the computational domain (grid spacing, number of cells).</p></li>
<li><p><em>vector</em>: a simple 1-D array of floats.</p></li>
<li><p><em>cell field</em>: a vector storing cell-centered values (e.g., temperature, tendencies).</p></li>
<li><p><em>face field</em>: a vector storing face-centered values (e.g., diffusive fluxes).</p></li>
</ul>
<p>Let’s start simple and define a type alias for vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s define a mesh <em>data class</em>, i.e., a simple data structure intended for storing data without much additional functionality. Since our approach is procedural, we won’t rely much on object-oriented programming features beyond this simple data class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Mesh</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uniform 1-D mesh.&quot;&quot;&quot;</span>
    
    <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># cell size</span>
    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span>     <span class="c1"># number of cells</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cell_field</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">vec</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">face_field</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">vec</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice the helper methods <code class="docutils literal notranslate"><span class="pre">cell_field</span></code> and <code class="docutils literal notranslate"><span class="pre">face_field</span></code> that create zero-initialized fields of the appropriate size based on the mesh.</p>
</section>
<section id="procedures">
<h4>Procedures:<a class="headerlink" href="#procedures" title="Link to this heading">#</a></h4>
<p>Recall the abstraction and decomposition principles we discussed for procedural abstraction, i.e.,</p>
<ul class="simple">
<li><p>Each procedure should have a single, well-defined purpose.</p></li>
<li><p>Procedures should be general: avoid hard-coding specific values or assumptions.</p></li>
<li><p>Each procedure should be as simple as possible, but no simpler.</p></li>
</ul>
<p>Based on these principles, we can define the following <em>general</em> procedures:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">apply_bc(f,</span> <span class="pre">bc)</span></code>: apply boundary conditions to face fluxes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">diffusive_flux(f,</span> <span class="pre">c,</span> <span class="pre">kappa,</span> <span class="pre">dx)</span></code>: compute interior fluxes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">divergence(c,</span> <span class="pre">f,</span> <span class="pre">dx)</span></code>: compute tendencies from fluxes.</p></li>
</ul>
<p>The argument names use conventions to clarify the placement of vectors on the mesh:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">f</span></code> to denote face fields.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">c</span></code> to denote cell fields.</p></li>
</ul>
<p>This keeps the procedures general and reusable for different types of fields. If we were to compute the diffusive fluxes of a different quantity (e.g., concentration), we could reuse the same <code class="docutils literal notranslate"><span class="pre">diffusive_flux</span></code> procedure without modification. (This is called <em>abstraction by parameterization</em>.)</p>
<p>In addition to the above general procedures, we need two more, specific to the heat equation solver. For
these, the argument names are more specific to clarify their purpose:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">step_heat_eqn(u,</span> <span class="pre">F,</span> <span class="pre">dudt,</span> <span class="pre">kappa,</span> <span class="pre">dt,</span> <span class="pre">mesh,</span> <span class="pre">bc)</span></code>: advance one time step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">solve_heat_eqn(u0,</span> <span class="pre">kappa,</span> <span class="pre">dt,</span> <span class="pre">nt,</span> <span class="pre">dx,</span> <span class="pre">bc)</span></code>: orchestrate multiple steps.</p></li>
</ul>
</section>
</section>
<section id="step-3-specification">
<h3>Step 3 – Specification<a class="headerlink" href="#step-3-specification" title="Link to this heading">#</a></h3>
<p>Recall, our practical approach to specification combines:</p>
<ul class="simple">
<li><p>type annotations</p></li>
<li><p>pre- and postconditions as assertions.</p></li>
</ul>
<p>First, let’s write a core API that capture our procedural abstractions. This will
include only the function signatures, i.e., functions names, arguments, and brief descriptions.
While doing so, we’ll include the first constituent of our specifications: type annotations.</p>
<p>This isn’t about writing code yet: it’s about specifying the conceptual architecture of the system.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Procedures:</span>

<span class="k">def</span><span class="w"> </span><span class="nf">apply_bc</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply BCs by overriding first and last face quantities (f).&quot;&quot;&quot;</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">diffusive_flux</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a cell field (c), compute the diffusive flux (f).&quot;&quot;&quot;</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">divergence</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the divergence of face quantities (f) and store in (c).&quot;&quot;&quot;</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">step_heat_eqn</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">F</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dudt</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Advance cell field u by one time step using explicit Euler method.&quot;&quot;&quot;</span>
    <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">solve_heat_eqn</span><span class="p">(</span><span class="n">u0</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nt</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">vec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrate nt steps over cell field u.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p>Having defined the core API and type annotations, we can now add the next layer of specifications:</p>
<ul class="simple">
<li><p>preconditions and postconditions as executable assertions.</p></li>
</ul>
<p>Take the <code class="docutils literal notranslate"><span class="pre">divergence</span></code> function that computes the divergence of face fluxes:</p>
<p><span class="math notranslate nohighlight">\(\qquad
\nabla \cdot F = \frac{F_{i} - F_{i+1}}{\Delta x}
\qquad\)</span></p>
<p>Given the above formula, one can identify two key preconditions:</p>
<ul class="simple">
<li><p>The vector <code class="docutils literal notranslate"><span class="pre">c</span></code> (output) and the vector <code class="docutils literal notranslate"><span class="pre">f</span></code> (input) must have compatible sizes: specifically, <code class="docutils literal notranslate"><span class="pre">len(c)</span> <span class="pre">==</span> <span class="pre">len(f)</span> <span class="pre">-</span> <span class="pre">1</span></code>.</p></li>
<li><p>The mesh spacing <code class="docutils literal notranslate"><span class="pre">dx</span></code> must be positive.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">divergence</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the divergence of face quantities (f) and store in (c).&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Size mismatch&quot;</span>
    <span class="k">assert</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Non-positive dx&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p>As for the postcondition, we can use a mathematical property of the divergence operator to define it precisely:</p>
<p><strong>Telescoping Property of Divergence</strong>: The sum of the divergence over all cells equals the net flux through the boundaries.</p>
<p><span class="math notranslate nohighlight">\(\qquad
\sum_{i=0}^{N-1} (\nabla \cdot F)_i = F_0 - F_N
\qquad\)</span></p>
<p>We can encode this property as a function that returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the property holds, and <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">telescoping</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the finite volume telescoping property.&quot;&quot;&quot;</span>
    <span class="n">total_divergence</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">boundary_flux</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">total_divergence</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">boundary_flux</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can then add this check as a postcondition in the <code class="docutils literal notranslate"><span class="pre">divergence</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">divergence</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the divergence of face quantities (f) and store in (c).&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Size mismatch&quot;</span>
    <span class="k">assert</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Non-positive dx&quot;</span>
    <span class="o">...</span>
    <span class="k">assert</span> <span class="n">telescoping</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>           <span class="c1"># {C} Postcondition</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-2-2">
<h3>Exercise 2.2:<a class="headerlink" href="#exercise-2-2" title="Link to this heading">#</a></h3>
<p>One of the key preconditions for the Euler (FTCS) scheme is the stability condition as given below:</p>
<p><span class="math notranslate nohighlight">\(\qquad
\Delta t \leq \frac{\Delta x^2}{2 \kappa}
\qquad\)</span></p>
<p>Implement a function <code class="docutils literal notranslate"><span class="pre">stability_condition(...)</span></code> that checks this condition. Which
function(s) would you add this as a precondition to?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">stability_condition</span><span class="p">(</span><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the stability condition for the explicit Euler scheme.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Answer:</strong></p>
<p>Below is a possible implementation of the <code class="docutils literal notranslate"><span class="pre">is_stable</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">stability_condition</span><span class="p">(</span><span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the stability condition for the explicit Euler scheme.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dt</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kappa</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">stability_condition</span></code> can be added as a precondition to the <code class="docutils literal notranslate"><span class="pre">solve_heat_eqn</span></code> function, as it ensures that the time step <code class="docutils literal notranslate"><span class="pre">dt</span></code> is appropriate for the spatial discretization <code class="docutils literal notranslate"><span class="pre">dx</span></code> and the diffusion coefficient <code class="docutils literal notranslate"><span class="pre">kappa</span></code>, which is crucial for the stability of the explicit Euler scheme used in the heat equation solver.</p>
</section>
<section id="exercise-2-3">
<h3>Exercise 2.3:<a class="headerlink" href="#exercise-2-3" title="Link to this heading">#</a></h3>
<p>Now let’s check whether heat is conserved in our solver. The condition for conservation can be expressed as:</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=0}^{N-1} u_i^{n+1} \Delta x = \sum_{i=0}^{N-1} u_i^{n} \Delta x + \Delta t \left( q_L - q_R \right).
\]</div>
<p>with special Cases:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">q_L</span></code> == <code class="docutils literal notranslate"><span class="pre">q_R</span></code> == 0, the mean stays constant.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">q_L</span></code> and <code class="docutils literal notranslate"><span class="pre">q_R</span></code> are constant, the temperature profile converges to a linear steady state.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">heat_is_conserved</span><span class="p">(</span><span class="n">u_sum_old</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">u_sum_new</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">F</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if heat is conserved.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Answer:</strong></p>
<p>The he following cell contains a possible implementation of the heat conservation check. As for which function(s) would need to be modified to incorporate this check, it may be added as a postcondition to the step function, or, alternatively, it may be added as a loop invariant in the timestepping loop within the solve function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">heat_is_conserved</span><span class="p">(</span><span class="n">u_sum_old</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">u_sum_new</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">F</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if heat is conserved.&quot;&quot;&quot;</span>
    <span class="n">expected_change</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">actual_change</span> <span class="o">=</span> <span class="n">u_sum_new</span> <span class="o">-</span> <span class="n">u_sum_old</span>
    <span class="k">return</span> <span class="n">actual_change</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">expected_change</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Loop invariants</strong></p>
<p>A loop invariant is a condition (a boolean expression) that holds true before and after each iteration of a loop. It helps reason about the correctness of the loop by ensuring that certain properties hold:</p>
<ul class="simple">
<li><p>before the loop starts</p></li>
<li><p>after each iteration of the loop</p></li>
</ul>
<p>which guarantees that once the loop has finished executing, the desired property holds for the final state.</p>
<p>In the case of the heat equation solver, ensuring that heat is conserved after each time step guarantees that the total heat within the domain remains constant.</p>
</section>
<section id="step-4-implementation">
<h3>Step 4 – Implementation<a class="headerlink" href="#step-4-implementation" title="Link to this heading">#</a></h3>
<p>With abstractions identified, pieces decomposed, and specifications written, we can implement code that satisfies them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">apply_bc</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply BCs by overriding first and last face quantities (f).&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">diffusive_flux</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a cell field (c), compute the diffusive flux (f).&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Size mismatch&quot;</span>
    <span class="k">assert</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Non-positive dx&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">divergence</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the divergence of face quantities (f) and store in (c).&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Size mismatch&quot;</span>
    <span class="k">assert</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Non-positive dx&quot;</span>
    <span class="n">c</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">dx</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))]</span>
    <span class="c1">#for i in range(len(c)):</span>
    <span class="c1">#    c[i] = (f[i] - f[i+1]) / dx</span>
    <span class="k">assert</span> <span class="n">telescoping</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">step_heat_eqn</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">F</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dudt</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Advance cell field u by one time step using explicit Euler method.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Non-positive dt&quot;</span>
    <span class="k">assert</span> <span class="n">mesh</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dudt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Size mismatch&quot;</span>

    <span class="n">apply_bc</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
    <span class="n">diffusive_flux</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">divergence</span><span class="p">(</span><span class="n">dudt</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
        <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dudt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">solve_heat_eqn</span><span class="p">(</span><span class="n">u0</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nt</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">vec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrate nt steps over cell field u.&quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="n">nt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Number of time steps must be positive&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Boundary conditions must be a list of two values&quot;</span>
    <span class="k">assert</span> <span class="n">stability_condition</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">kappa</span><span class="p">),</span> <span class="s2">&quot;Stability condition not met&quot;</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">))</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">face_field</span><span class="p">()</span>
    <span class="n">dudt</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_field</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
        <span class="n">u_sum_old</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">step_heat_eqn</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">dudt</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
        <span class="n">u_sum_new</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">dx</span>
        <span class="k">assert</span> <span class="n">heat_is_conserved</span><span class="p">(</span><span class="n">u_sum_old</span><span class="p">,</span> <span class="n">u_sum_new</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">F</span><span class="p">),</span> <span class="s2">&quot;Heat not conserved&quot;</span>

    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solve_heat_eqn</span><span class="p">(</span>
    <span class="n">u0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">bc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[33.333333333333314, 33.33333333333333, 33.333333333333314]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="what-we-just-did">
<h2>What we just did<a class="headerlink" href="#what-we-just-did" title="Link to this heading">#</a></h2>
<p>We now have a solver whose structure and reasoning are explicit. It’s modular: each function
has a single purpose over well-defined data.</p>
<p>We did write a lot more lines, because we added:</p>
<ul class="simple">
<li><p>Isolation of concerns (apply_bc, flux, divergence, step, solve) instead of one monolith</p></li>
<li><p>Type annotations</p></li>
<li><p>Executable contracts (pre/postconditions, invariants)</p></li>
<li><p>Lightweight data types (Mesh, vec)</p></li>
</ul>
<p><strong>In real applications</strong>, this “ceremony” is a small fraction of total code: The heavy lifting
lives in numerical computations, I/O, parallelization, physics, etc.. The scaffolding pays
off by reducing change amplification and cognitive load:</p>
<ul class="simple">
<li><p>Safer changes (localized edits)</p></li>
<li><p>Better testing (unit, property, etc.)</p></li>
<li><p>Faster debugging (failures point to where)</p></li>
<li><p>Reusability (shared abstractions)</p></li>
</ul>
<p><strong>Do assertions hurt performance?</strong> Potentially, if run every step. In practice you can disable
them for production (<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-O</span></code>) or sample them periodically during long runs.</p>
</section>
<section id="looking-ahead">
<h2>Looking Ahead<a class="headerlink" href="#looking-ahead" title="Link to this heading">#</a></h2>
<p>In <strong>Chapter 3</strong>, we’ll take the next step:<br />
turning these specifications into unit tests that run automatically,
giving us rapid feedback and confidence as our code evolves.</p>
<hr class="docutils" />
<p><em>This notebook is a part of the “Rigor and Reasoning in Research Software” (R3Sw) tutorial, led by Alper Altuntas and sponsored by the Better Scientific Software (BSSw) Fellowship Program. Copyright © 2025</em></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ch1_code_and_fix.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 1: Code and Fix</p>
      </div>
    </a>
    <a class="right-next"
       href="ch3_unit_testing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 3: Unit Testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstraction">1. Abstraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-abstraction-vs-procedural-abstraction">Data Abstraction vs. Procedural Abstraction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposition">2. Decomposition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specification-writing-down-intent">3. Specification: Writing Down Intent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-example">A simple example:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-1">Exercise 2.1:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-writing-code-that-meets-specifications">4. Implementation: Writing Code that Meets Specifications</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heat-equation-solver-revisited">Heat Equation Solver, Revisited</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-abstraction">Step 1 — Abstraction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-decomposition">Step 2 – Decomposition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-structures">Data Structures:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#procedures">Procedures:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-specification">Step 3 – Specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-2">Exercise 2.2:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-3">Exercise 2.3:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-implementation">Step 4 – Implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-just-did">What we just did</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#looking-ahead">Looking Ahead</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alper Altuntas, et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>