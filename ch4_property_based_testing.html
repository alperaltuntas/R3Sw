
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chapter 4: Property-Based Testing &#8212; Rigor and Reasoning in Research Software (R3Sw)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-V7VKREZ5MB"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-V7VKREZ5MB');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-V7VKREZ5MB');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ch4_property_based_testing';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 5: Bounded Formal Verification" href="ch5_theorem_proving.html" />
    <link rel="prev" title="Chapter 3: Unit Testing" href="ch3_unit_testing.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="welcome.html">
  
  
  
  
  
  
    <p class="title logo__title">Rigor and Reasoning in Research Software (R3Sw)</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="welcome.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1_code_and_fix.html">Chapter 1: Code and Fix</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch2_reasoning.html">Chapter 2: Reasoning About Code</a></li>

<li class="toctree-l1"><a class="reference internal" href="ch3_unit_testing.html">Chapter 3: Unit Testing</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 4: Property-Based Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5_theorem_proving.html">Chapter 5: Bounded Formal Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="closing_remarks.html">Closing Remarks: Climbing the Ladder of Rigor</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/alperaltuntas/R3Sw/blob/main/notebooks/ch4_property_based_testing.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/ch4_property_based_testing.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 4: Property-Based Testing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-property">What is a “property”?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-tests-vs-property-based-tests">Unit tests vs. property-based tests:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-this-relates-to-chapter-2">How this relates to Chapter 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-hypothesis-library">The <code class="docutils literal notranslate"><span class="pre">Hypothesis</span></code> library</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hypothesis-to-the-rescue">Hypothesis to the rescue</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shrinking">Shrinking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-your-own-strategies">Making your own strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-strategies">Combining strategies</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#other-approaches">Other approaches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-hypothesis">Controlling Hypothesis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-examples-are-generated">How many examples are generated</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#observability">Observability</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-to-the-heat-equation-solver">Back to the Heat Equation Solver</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaffolding">Scaffolding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#telescoping-property-what-goes-out-one-cell-must-go-in-the-next-cell">Telescoping Property : “what goes out one cell must go in the next cell”</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conservation">Conservation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#symmetry">Symmetry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monotonicity">Monotonicity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beware-of-assume">Beware of <code class="docutils literal notranslate"><span class="pre">assume</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-test-case-generation-with-st-composite">Advanced test-case generation with <code class="docutils literal notranslate"><span class="pre">st.composite</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#st-data"><code class="docutils literal notranslate"><span class="pre">st.data()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#st-composite"><code class="docutils literal notranslate"><span class="pre">st.composite()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-just-did">What we just did</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-lessons-to-take-away">Some lessons to take away</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#looking-ahead">Looking Ahead</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-4-property-based-testing">
<h1>Chapter 4: Property-Based Testing<a class="headerlink" href="#chapter-4-property-based-testing" title="Link to this heading">#</a></h1>
<p>In Chapters 1–3, we moved from a quick, monolithic solver to a modular design with unit tests.
Unit tests gave us confidence, but only for cases that we handpicked.</p>
<p>Now, we’ll take the next step by introducing property-based testing via the Hypothesis
library:</p>
<ul class="simple">
<li><p>Instead of manually writing individual test cases, we’ll state general properties that must be satisfied by the solution such as conservation, symmetry, maximum principle intuition, or linearity.</p></li>
<li><p>We will also specify a function that generates valid test inputs. For each input, we assert that these properties hold.</p></li>
<li><p>Hypothesis will generate many random inputs automatically, exploring cases we might never think to test.</p></li>
<li><p>When a property fails, Hypothesis will shrink the failing case to the simplest possible counterexample, the testing equivalent of a controlled scientific experiment.</p></li>
</ul>
<section id="what-is-a-property">
<h2>What is a “property”?<a class="headerlink" href="#what-is-a-property" title="Link to this heading">#</a></h2>
<p>A property is a statement about your program that you expect to hold for all valid inputs.
It’s a general rule, not just a single example.</p>
<p>For our 1-D heat equation solver, some key properties might include:</p>
<ul class="simple">
<li><p><strong>Conservation:</strong> total heat stays constant.</p></li>
<li><p><strong>Telescoping property:</strong> The sum of the divergence over all cells equals the net flux through the boundaries.</p></li>
<li><p><strong>Symmetry:</strong> symmetric initial states stay symmetric under symmetric BCs.</p></li>
<li><p><strong>Monotonicity:</strong> non-decreasing initial states remain non-decreasing.</p></li>
</ul>
</section>
<section id="unit-tests-vs-property-based-tests">
<h2>Unit tests vs. property-based tests:<a class="headerlink" href="#unit-tests-vs-property-based-tests" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Unit tests: “for this input, expect this output”</p></li>
<li><p>Property tests: “for all inputs satisfying these preconditions, this relation should hold”</p></li>
</ul>
<p>Property tests complement unit tests:</p>
<ul class="simple">
<li><p>Unit tests are concrete and focused.</p></li>
<li><p>Property tests are broader and can reveal edge cases you never anticipated.</p></li>
</ul>
</section>
<section id="how-this-relates-to-chapter-2">
<h2>How this relates to Chapter 2<a class="headerlink" href="#how-this-relates-to-chapter-2" title="Link to this heading">#</a></h2>
<p>In Chapter 2, we introduced preconditions, postconditions, and invariants as lightweight specifications for our solver.</p>
<p>Property-based testing is a natural extension of these ideas:</p>
<ul class="simple">
<li><p>The precondition {P} now defines the input space that Hypothesis will explore.</p></li>
<li><p>The postcondition {Q} or invariant becomes the property being checked.</p></li>
<li><p>When a test fails, Hypothesis provides a counterexample, helping you determine whether:</p>
<ul>
<li><p>The precondition was too weak (i.e., it allowed invalid inputs).</p></li>
<li><p>The postcondition was too strong (i.e., it ruled out valid outputs).</p></li>
<li><p>There’s a bug in the implementation.</p></li>
</ul>
</li>
</ul>
<p>Think of this as turning your Chapter 2 contracts into scientific hypotheses:</p>
<ul class="simple">
<li><p>“If the precondition holds, the property should always be true.”</p></li>
</ul>
<p>Hypothesis plays the role of the experimenter, probing your code with many randomized “experiments” to try and refute your claim.</p>
</section>
<section id="the-hypothesis-library">
<h2>The <code class="docutils literal notranslate"><span class="pre">Hypothesis</span></code> library<a class="headerlink" href="#the-hypothesis-library" title="Link to this heading">#</a></h2>
<p>Hypothesis is a Python library for property-based testing.
Instead of handpicking test cases, you describe the space of valid inputs, and it generates random examples within that space.</p>
<p>If a failure is found, Hypothesis automatically <em>shrinks</em> the input to the simplest version that still causes the failure. This helps you debug by giving a clear, minimal failing example.</p>
<p>Let’s revisit our <code class="docutils literal notranslate"><span class="pre">div</span></code> function from the previous chapters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %xmode Minimal  </span>

<span class="k">def</span><span class="w"> </span><span class="nf">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>           <span class="c1"># P    (precondition)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>             <span class="c1"># code (implementation)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span>     <span class="c1"># Q    (postcondition)</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<p>In Chapter 3, we tested this manually:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_division</span><span class="p">():</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

<span class="n">test_division</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_division</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">test_division</span><span class="p">()</span>

<span class="nn">Cell In[2], line 2,</span> in <span class="ni">test_division</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_division</span><span class="p">():</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

<span class="nn">Cell In[1], line 6,</span> in <span class="ni">div</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>           <span class="c1"># P    (precondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>             <span class="c1"># code (implementation)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span>     <span class="c1"># Q    (postcondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">return</span> <span class="n">res</span>

<span class="ne">AssertionError</span>: 
</pre></div>
</div>
</div>
</div>
<p>Running this fails because 7 / 25 cannot be represented exactly in floating point.
But notice: we only found this case because we happened to test exactly this input.
If we had tested other pairs like the ones listed below, the test
might have passed, which would leave us unaware of the issue.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_more_divisions</span><span class="p">():</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">7657</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">div</span> <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">23424</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span><span class="mi">456</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No assertion violations encountered!&quot;</span><span class="p">)</span>

<span class="n">test_more_divisions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No assertion violations encountered!
</pre></div>
</div>
</div>
</div>
<section id="hypothesis-to-the-rescue">
<h3>Hypothesis to the rescue<a class="headerlink" href="#hypothesis-to-the-rescue" title="Link to this heading">#</a></h3>
<p>Let’s use Hypothesis to generate a wide range of test cases for our division function.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">assume</span><span class="p">,</span> <span class="n">given</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>


<span class="c1"># Read this as:</span>
<span class="c1"># given</span>
<span class="nd">@given</span><span class="p">(</span>
    <span class="c1"># (a) one randomly drawn integer</span>
    <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(),</span>
    <span class="c1"># (b) another randomly drawn integer</span>
    <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1"># test this property</span>
    <span class="c1"># (c) reject y == 0</span>
    <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># test that division succeeds</span>
    <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The above test definition highlights the key components of property-based testing with Hypothesis:</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">&#64;given</span></code> decorator</p>
<ul class="simple">
<li><p>This is the main entry point for defining a property-based test.</p></li>
<li><p>It takes zero or more strategies as arguments, which describe how Hypothesis should generate input data for the test.</p></li>
</ul>
</li>
<li><p>Strategies</p>
<ul class="simple">
<li><p>Use strategies to define the space of possible inputs.</p></li>
<li><p>In our example, we used <code class="docutils literal notranslate"><span class="pre">st.integers()</span></code> to generate random integers for both x and y.</p></li>
<li><p>Hypothesis comes with a number of built-in <a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/reference/strategies.html#">strategies</a>. These strategies effectively define how the input space is explored, and how a failing example is shrunk to a “simpler” case. Usually you’ll compose a number of built-in strategies to generate input data that is appropriate for your problem.</p></li>
<li><p>Here is an <a class="reference external" href="https://github.com/zarr-developers/zarr-python/blob/eb1b6e869115925f7b653e60bd542abd410a9a4e/src/zarr/testing/strategies.py#L88-L100">example</a> from Zarr of generating input data that matches a written specification.</p></li>
</ul>
</li>
</ol>
<p>We also used the <code class="docutils literal notranslate"><span class="pre">assume</span></code> function to enforce our precondition {P}.
Here, the precondition is that <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">!=</span> <span class="pre">0</span></code> to avoid division by zero. Adding <code class="docutils literal notranslate"><span class="pre">assume(y</span> <span class="pre">!=</span> <span class="pre">0)</span></code> ensures that we only test valid inputs.</p>
<p>With these pieces in place, we can now run the property-based test and let Hypothesis explore a wide range of inputs automatically:</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_div_property</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">test_div_property</span><span class="p">()</span>

<span class="nn">Cell In[4], line 8,</span> in <span class="ni">test_div_property</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Read this as:</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># given</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="nd">@given</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">8</span>     <span class="c1"># (a) one randomly drawn integer</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(),</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="c1"># (b) another randomly drawn integer</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="c1"># test this property</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="c1"># (c) reject y == 0</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="c1"># test that division succeeds</span>

    <span class="p">[</span><span class="o">...</span> <span class="n">skipping</span> <span class="n">hidden</span> <span class="mi">1</span> <span class="n">frame</span><span class="p">]</span>

<span class="nn">Cell In[4], line 18,</span> in <span class="ni">test_div_property</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="c1"># test that division succeeds</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nn">Cell In[1], line 6,</span> in <span class="ni">div</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>           <span class="c1"># P    (precondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>             <span class="c1"># code (implementation)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span>     <span class="c1"># Q    (postcondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">return</span> <span class="n">res</span>

<span class="ne">AssertionError</span>: 
<span class="n">Falsifying</span> <span class="n">example</span><span class="p">:</span> <span class="n">test_div_property</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Running the above property-based test should reveal a pair of integers (x, y) that violate the division property. Recall, the inputs are generated randomly, so you might see different failing cases each time you run the test.</p>
</section>
<section id="shrinking">
<h3>Shrinking<a class="headerlink" href="#shrinking" title="Link to this heading">#</a></h3>
<p>Hypothesis automatically <em>shrinks</em> the input, step by step, until it finds the simplest failing
example. This makes debugging much easier, since you don’t need to wade through massive random inputs.</p>
<p>Shrinking &amp; test case generation is why you should use a property testing library. While you might be able
to generate random inputs, shrinking and input space exploration is a hard problem!</p>
</section>
<section id="making-your-own-strategies">
<h3>Making your own strategies<a class="headerlink" href="#making-your-own-strategies" title="Link to this heading">#</a></h3>
<section id="combining-strategies">
<h4>Combining strategies<a class="headerlink" href="#combining-strategies" title="Link to this heading">#</a></h4>
<p>In the above example, we only tested integer division. However, we can also test floating-point division by using the <code class="docutils literal notranslate"><span class="pre">st.floats()</span></code> strategy from Hypothesis. Better yet, we can combine both strategies to test the <code class="docutils literal notranslate"><span class="pre">div</span></code> function with a wider range of inputs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">assume</span><span class="p">,</span> <span class="n">given</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="c1"># Combine integers and floats into a single strategy:</span>
<span class="c1"># `st.one_of` shrinks such that the earlier strategy is considered &quot;simpler&quot;</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">one_of</span><span class="p">(</span>
    <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(),</span>
    <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Tip</strong> An important feature of strategies is that you can call <code class="docutils literal notranslate"><span class="pre">.example</span></code> to get an example generated value! This function really helps one create strategies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numbers</span><span class="o">.</span><span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5961997760912302.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@given</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_div_property</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">test_div_property</span><span class="p">()</span>

<span class="nn">Cell In[8], line 2,</span> in <span class="ni">test_div_property</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="nd">@given</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="p">[</span><span class="o">...</span> <span class="n">skipping</span> <span class="n">hidden</span> <span class="mi">1</span> <span class="n">frame</span><span class="p">]</span>

<span class="nn">Cell In[8], line 4,</span> in <span class="ni">test_div_property</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="nd">@given</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nn">Cell In[1], line 6,</span> in <span class="ni">div</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>           <span class="c1"># P    (precondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>             <span class="c1"># code (implementation)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span>     <span class="c1"># Q    (postcondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">return</span> <span class="n">res</span>

<span class="ne">AssertionError</span>: 
<span class="n">Falsifying</span> <span class="n">example</span><span class="p">:</span> <span class="n">test_div_property</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="mf">8.988465674311578e+307</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="other-approaches">
<h4>Other approaches<a class="headerlink" href="#other-approaches" title="Link to this heading">#</a></h4>
<p>Hypotheisis provides a lot more!</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">st.builds</span></code> to construct custom objects with arguments generated from strategies;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">st.sampled_from</span></code> to sample from a list of choices</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">st.just</span></code> for always yielding one value (very useful when limiting search space)</p></li>
<li><p>modify a strategy’s outputs using <code class="docutils literal notranslate"><span class="pre">.filter</span></code> and <code class="docutils literal notranslate"><span class="pre">.map</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">st.composite</span></code> for more advanced generation (see example later)</p></li>
</ol>
<p>See <a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/tutorial/builtin-strategies.html">this page</a> for more.</p>
</section>
</section>
<section id="controlling-hypothesis">
<h3>Controlling Hypothesis<a class="headerlink" href="#controlling-hypothesis" title="Link to this heading">#</a></h3>
<section id="how-many-examples-are-generated">
<h4>How many examples are generated<a class="headerlink" href="#how-many-examples-are-generated" title="Link to this heading">#</a></h4>
<p>By default, <code class="docutils literal notranslate"><span class="pre">hypothesis</span></code> generates 100 random input values. You can control this with the <code class="docutils literal notranslate"><span class="pre">&#64;settings</span></code> decorator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>

<span class="n">ctr</span> <span class="o">=</span> <span class="mi">0</span>


<span class="nd">@settings</span><span class="p">(</span><span class="n">max_examples</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nd">@given</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">())</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_random</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">ctr</span>
    <span class="n">ctr</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test no. </span><span class="si">{</span><span class="n">ctr</span><span class="si">}</span><span class="s2"> with random input </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">test_random</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test no. 1 with random input 0
Test no. 2 with random input -818
Test no. 3 with random input -3022168159676768025
Test no. 4 with random input -16816
Test no. 5 with random input -77
Test no. 6 with random input 11985
Test no. 7 with random input -24
Test no. 8 with random input -96
Test no. 9 with random input 2298008641686346705
Test no. 10 with random input 31947
</pre></div>
</div>
</div>
</div>
<p>In the above cell, we reduced <code class="docutils literal notranslate"><span class="pre">max_examples</span></code> from the default 100 to 10. In practice, one
should consider increasing the <code class="docutils literal notranslate"><span class="pre">max_examples</span></code> parameter based on the complexity of the property being tested, particularly in the absence of failing cases when no counterexamples are found.</p>
</section>
<section id="observability">
<h4>Observability<a class="headerlink" href="#observability" title="Link to this heading">#</a></h4>
<p>Hypothesis caches failing examples for future checks. Let’s clear that</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>rm<span class="w"> </span>-r<span class="w"> </span>.hypothesis
</pre></div>
</div>
</div>
</div>
<p>Now we’ll enable verbose output and run the test. Hypothesis will print out all the examples it is trying. This is usually good to do when developing tests to  get a sense of the space being explored.</p>
<div class="cell tag_raises-exception docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">Verbosity</span>

<span class="nd">@settings</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">Verbosity</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
<span class="nd">@given</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="c1"># comment &amp; uncomment this line to invalidate the hypothesis cache.</span>
    <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="n">test_div_property</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Trying example: test_div_property(
    x=0,
    y=0,
)
Trying example: test_div_property(
    x=0.0,
    y=0,
)
Trying example: test_div_property(
    x=2.220446049250313e-16,
    y=0,
)
Trying example: test_div_property(
    x=-7658,
    y=0,
)
Trying example: test_div_property(
    x=-8.068738610735183e+63,
    y=0,
)
Trying example: test_div_property(
    x=-6.753279163496331e+16,
    y=0,
)
Trying example: test_div_property(
    x=38,
    y=2.086046650819329e-132,
)
Trying example: test_div_property(
    x=29754,
    y=4,
)
Trying example: test_div_property(
    x=24783,
    y=-420264230,
)
Trying example: test_div_property(
    x=-1.2124046867423162e-101,
    y=14076,
)
Trying example: test_div_property(
    x=-26,
    y=16195,
)
Trying example: test_div_property(
    x=-7.382336043201933e-272,
    y=2_692_603_946_087_437_967,
)
Trying example: test_div_property(
    x=-1.842098636085868e+16,
    y=-32314,
)
Trying example: test_div_property(
    x=29045,
    y=-2_001_233_375,
)
Trying example: test_div_property(
    x=18,
    y=-5885066336975300.0,
)
Trying example: test_div_property(
    x=7277920628992536.0,
    y=-8571323423208478.0,
)
Trying example: test_div_property(
    x=7277920628992536.0,
    y=7277920628992536.0,
)
Trying example: test_div_property(
    x=-75,
    y=-2.5329626842103436e+16,
)
Trying example: test_div_property(
    x=0.0,
    y=-2.5329626842103436e+16,
)
Trying example: test_div_property(
    x=-2.5329626842103436e+16,
    y=-2.5329626842103436e+16,
)
Trying example: test_div_property(
    x=79,
    y=-85,
)
Trying example: test_div_property(
    x=-85,
    y=-85,
)
Trying example: test_div_property(
    x=520501743,
    y=4.634958721768219e+16,
)
Trying example: test_div_property(
    x=4.634958721768219e+16,
    y=4.634958721768219e+16,
)
Trying example: test_div_property(
    x=6.506895718169253e+16,
    y=2.1606565086673316e+16,
)
Trying example: test_div_property(
    x=6.506895718169253e+16,
    y=6.506895718169253e+16,
)
Trying example: test_div_property(
    x=1.6122976437473211e-12,
    y=-5e-324,
)
Traceback (most recent call last):
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/4209601294.py&quot;, line 8, in test_div_property
    div(x, y)
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/249070609.py&quot;, line 6, in div
    assert res * y == x     # Q    (postcondition)
           ^^^^^^^^^^^^
AssertionError

Trying example: test_div_property(
    x=-5e-324,
    y=-5e-324,
)
Trying example: test_div_property(
    x=1.6122976437473211e-12,
    y=1.6122976437473211e-12,
)
Trying example: test_div_property(
    x=-1.7976931348623157e+308,
    y=7436674208527465.0,
)
Trying example: test_div_property(
    x=-1.7976931348623157e+308,
    y=-1.7976931348623157e+308,
)
Trying example: test_div_property(
    x=-3.9641516231600954e-80,
    y=126,
)
Trying example: test_div_property(
    x=-3.9641516231600954e-80,
    y=-3.9641516231600954e-80,
)
Trying example: test_div_property(
    x=779,
    y=16567,
)
Trying example: test_div_property(
    x=16567,
    y=16567,
)
Trying example: test_div_property(
    x=1.612062017331883e-127,
    y=-2515,
)
Trying example: test_div_property(
    x=1.612062017331883e-127,
    y=0.0,
)
Trying example: test_div_property(
    x=1.612062017331883e-127,
    y=1.612062017331883e-127,
)
Trying example: test_div_property(
    x=1589112762884609.0,
    y=1e-05,
)
Trying example: test_div_property(
    x=1e-05,
    y=1e-05,
)
Trying example: test_div_property(
    x=21881,
    y=0.99999,
)
Trying example: test_div_property(
    x=0.0,
    y=0.99999,
)
Trying example: test_div_property(
    x=0.0,
    y=0.0,
)
Trying example: test_div_property(
    x=0.99999,
    y=0.99999,
)
Trying example: test_div_property(
    x=121,
    y=54,
)
Traceback (most recent call last):
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/4209601294.py&quot;, line 8, in test_div_property
    div(x, y)
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/249070609.py&quot;, line 6, in div
    assert res * y == x     # Q    (postcondition)
           ^^^^^^^^^^^^
AssertionError

Trying example: test_div_property(
    x=121,
    y=121,
)
Trying example: test_div_property(
    x=54,
    y=54,
)
Trying example: test_div_property(
    x=23224,
    y=1.4270812701223544e+16,
)
Trying example: test_div_property(
    x=0.0,
    y=1.4270812701223544e+16,
)
Trying example: test_div_property(
    x=1.4270812701223544e+16,
    y=1.4270812701223544e+16,
)
Trying example: test_div_property(
    x=-22464,
    y=-1.192092896e-07,
)
Trying example: test_div_property(
    x=-22464,
    y=0,
)
Trying example: test_div_property(
    x=0.0,
    y=-1.192092896e-07,
)
Trying example: test_div_property(
    x=-1.192092896e-07,
    y=-1.192092896e-07,
)
Trying example: test_div_property(
    x=121,
    y=54,
)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/4209601294.py&quot;, line 8, in test_div_property
    div(x, y)
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/249070609.py&quot;, line 6, in div
    assert res * y == x     # Q    (postcondition)
           ^^^^^^^^^^^^
AssertionError

Trying example: test_div_property(
    x=121,
    y=0,
)
Trying example: test_div_property(
    x=0,
    y=54,
)
Trying example: test_div_property(
    x=54,
    y=121,
)
Trying example: test_div_property(
    x=121,
    y=1,
)
Trying example: test_div_property(
    x=121,
    y=22,
)
Trying example: test_div_property(
    x=121,
    y=27,
)
Traceback (most recent call last):
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/4209601294.py&quot;, line 8, in test_div_property
    div(x, y)
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/249070609.py&quot;, line 6, in div
    assert res * y == x     # Q    (postcondition)
           ^^^^^^^^^^^^
AssertionError

Trying example: test_div_property(
    x=121,
    y=13,
)
Traceback (most recent call last):
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/4209601294.py&quot;, line 8, in test_div_property
    div(x, y)
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/249070609.py&quot;, line 6, in div
    assert res * y == x     # Q    (postcondition)
           ^^^^^^^^^^^^
AssertionError

Trying example: test_div_property(
    x=121,
    y=6,
)
Trying example: test_div_property(
    x=121,
    y=11,
)
Trying example: test_div_property(
    x=121,
    y=12,
)
Trying example: test_div_property(
    x=121,
    y=-1,
)
Trying example: test_div_property(
    x=121,
    y=5,
)
Trying example: test_div_property(
    x=121,
    y=-5,
)
Trying example: test_div_property(
    x=121,
    y=-6,
)
Trying example: test_div_property(
    x=121,
    y=-11,
)
Trying example: test_div_property(
    x=121,
    y=-12,
)
Trying example: test_div_property(
    x=0,
    y=13,
)
Trying example: test_div_property(
    x=1,
    y=13,
)
Trying example: test_div_property(
    x=57,
    y=13,
)
Traceback (most recent call last):
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/4209601294.py&quot;, line 8, in test_div_property
    div(x, y)
  File &quot;/var/folders/f1/1h2dc57x5yg621dmd5y0gx1w0000gp/T/ipykernel_60913/249070609.py&quot;, line 6, in div
    assert res * y == x     # Q    (postcondition)
           ^^^^^^^^^^^^
AssertionError

Trying example: test_div_property(
    x=44,
    y=0,
)
Trying example: test_div_property(
    x=45,
    y=1,
)
Trying example: test_div_property(
    x=49,
    y=5,
)
Trying example: test_div_property(
    x=50,
    y=6,
)
Trying example: test_div_property(
    x=55,
    y=11,
)
Trying example: test_div_property(
    x=56,
    y=12,
)
Trying example: test_div_property(
    x=-44,
    y=0,
)
Trying example: test_div_property(
    x=-45,
    y=-1,
)
Trying example: test_div_property(
    x=-49,
    y=-5,
)
Trying example: test_div_property(
    x=-50,
    y=-6,
)
Trying example: test_div_property(
    x=-55,
    y=-11,
)
Trying example: test_div_property(
    x=-56,
    y=-12,
)
Trying example: test_div_property(
    x=25,
    y=13,
)
Trying example: test_div_property(
    x=28,
    y=13,
)
Trying example: test_div_property(
    x=55,
    y=13,
)
Trying example: test_div_property(
    x=56,
    y=13,
)
Trying example: test_div_property(
    x=-1,
    y=13,
)
Trying example: test_div_property(
    x=-25,
    y=13,
)
Trying example: test_div_property(
    x=-28,
    y=13,
)
Trying example: test_div_property(
    x=-55,
    y=13,
)
Trying example: test_div_property(
    x=-56,
    y=13,
)
Trying example: test_div_property(
    x=57,
    y=0,
)
Trying example: test_div_property(
    x=57,
    y=1,
)
Trying example: test_div_property(
    x=57,
    y=5,
)
Trying example: test_div_property(
    x=57,
    y=6,
)
Trying example: test_div_property(
    x=57,
    y=11,
)
Trying example: test_div_property(
    x=57,
    y=12,
)
Trying example: test_div_property(
    x=57,
    y=-1,
)
Trying example: test_div_property(
    x=57,
    y=-5,
)
Trying example: test_div_property(
    x=57,
    y=-6,
)
Trying example: test_div_property(
    x=57,
    y=-11,
)
Trying example: test_div_property(
    x=57,
    y=-12,
)
Trying example: test_div_property(
    x=56,
    y=14,
)
Trying example: test_div_property(
    x=56,
    y=0.0,
)
Trying example: test_div_property(
    x=13,
    y=57,
)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">test_div_property</span><span class="p">()</span>

<span class="nn">Cell In[12], line 4,</span> in <span class="ni">test_div_property</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">Verbosity</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nd">@settings</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">Verbosity</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="nd">@given</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="c1"># comment &amp; uncomment this line to invalidate the hypothesis cache.</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="p">[</span><span class="o">...</span> <span class="n">skipping</span> <span class="n">hidden</span> <span class="mi">1</span> <span class="n">frame</span><span class="p">]</span>

<span class="nn">Cell In[12], line 8,</span> in <span class="ni">test_div_property</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nd">@settings</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="n">Verbosity</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="nd">@given</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_div_property</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="c1"># comment &amp; uncomment this line to invalidate the hypothesis cache.</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">assume</span><span class="p">(</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">8</span>     <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="nn">Cell In[1], line 6,</span> in <span class="ni">div</span><span class="nt">(x, y)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">assert</span> <span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>           <span class="c1"># P    (precondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">res</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>             <span class="c1"># code (implementation)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="k">assert</span> <span class="n">res</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">x</span>     <span class="c1"># Q    (postcondition)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">return</span> <span class="n">res</span>

<span class="ne">AssertionError</span>: 
<span class="n">Falsifying</span> <span class="n">example</span><span class="p">:</span> <span class="n">test_div_property</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="mi">57</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="back-to-the-heat-equation-solver">
<h2>Back to the Heat Equation Solver<a class="headerlink" href="#back-to-the-heat-equation-solver" title="Link to this heading">#</a></h2>
<p>Now let’s use Hypothesis to test our heat equation solver.</p>
<p>We’ll focus on <em>invariants</em>. These invariants are mathematical properties satisfied by the solution to the equation.</p>
<ul class="simple">
<li><p><strong>Conservation:</strong> total heat stays constant.</p></li>
<li><p><strong>Telescoping property:</strong> The sum of the divergence over all cells equals the net flux through the boundaries.</p></li>
<li><p><strong>Symmetry preservation:</strong> symmetric initial states stay symmetric under symmetric BCs.</p></li>
<li><p><strong>Monotonicity:</strong> non-decreasing initial states remain non-decreasing.</p></li>
</ul>
<section id="scaffolding">
<h3>Scaffolding<a class="headerlink" href="#scaffolding" title="Link to this heading">#</a></h3>
<p>Before encoding our properties, we need to set up some scaffolding to facilitate testing.</p>
<p>First, let’s define some strategies for generating <em>sane</em> floating-point numbers for our tests:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">floats_st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
    <span class="n">min_value</span><span class="o">=-</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">kappa_st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
    <span class="n">min_value</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dx_st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">dt_st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s define a mesh size strategy to generate reasonable and manageable mesh sizes,
as well as a strategy for generating a tuple of boundary conditions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mesh sizes</span>
<span class="n">n_st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="n">fluxes_st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Boundary faces (qL, qR)</span>
<span class="c1"># generate 2 element tuples where each element is drawn from the strategy of floats</span>
<span class="n">bc_st</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">tuples</span><span class="p">(</span><span class="n">fluxes_st</span><span class="p">,</span> <span class="n">fluxes_st</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Remember you can use <code class="docutils literal notranslate"><span class="pre">.example</span></code> to check what’s generated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bc_st</span><span class="o">.</span><span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.401298464324817e-45, 94.4568636837738)
</pre></div>
</div>
</div>
</div>
</section>
<section id="telescoping-property-what-goes-out-one-cell-must-go-in-the-next-cell">
<h3>Telescoping Property : “what goes out one cell must go in the next cell”<a class="headerlink" href="#telescoping-property-what-goes-out-one-cell-must-go-in-the-next-cell" title="Link to this heading">#</a></h3>
<p>Before testing overall conservation, let’s start one level deeper with the local flux balance
that makes conservation possible.</p>
<p>In finite-volume discretizations, fluxes between neighboring cells telescope:
the flux leaving one cell enters the next (except in the presence of sources,
variable cell volumes or densities, or numerical errors.)</p>
<p>Consequently, when we sum the discrete divergence over all cells, the interior
fluxes cancel pairwise, leaving only the boundary contributions.
in other words, the total divergence equals the net flux through the boundaries:</p>
<p><span class="math notranslate nohighlight">\(\qquad
\sum_{i=0}^{N-1} (\nabla \cdot F)_i = F_0 - F_N
\qquad\)</span></p>
<p>Recall the encoding of this property:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">heat1d</span><span class="w"> </span><span class="kn">import</span> <span class="n">vec</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">step_heat_eqn</span>

<span class="k">def</span><span class="w"> </span><span class="nf">telescoping</span><span class="p">(</span><span class="n">divF</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">F</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the finite volume telescoping property.&quot;&quot;&quot;</span>
    <span class="n">total_divergence</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">divF</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">boundary_flux</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">total_divergence</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">boundary_flux</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We are now ready to implement the symmetry property test using Hypothesis:</p>
<section id="exercise">
<h4>Exercise:<a class="headerlink" href="#exercise" title="Link to this heading">#</a></h4>
<p>Below is the Hypothesis test for the telescoping property.
Insert the missing assumption(s) in the below test to ensure valid inputs for telescoping property using the <code class="docutils literal notranslate"><span class="pre">assume</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">heat1d</span>

<span class="nd">@settings</span><span class="p">(</span><span class="n">deadline</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="nd">@given</span><span class="p">(</span>
    <span class="n">F</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">floats_st</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span>
    <span class="n">dx</span><span class="o">=</span><span class="n">dx_st</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_telescoping_property</span><span class="p">(</span><span class="n">F</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Property: for randomly generated vector `F` &amp; spacing `dx`,</span>
<span class="sd">    the divergence divF using the function `divergence`,</span>
<span class="sd">    must satisfy the telescoping property.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># todo: compute divF using `heat1d.divergence`</span>
    <span class="k">assert</span> <span class="n">telescoping</span><span class="p">(</span><span class="n">divF</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">dx</span><span class="p">),</span> <span class="s2">&quot;Telescoping property violated&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test_telescoping_property()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="conservation">
<h3>Conservation<a class="headerlink" href="#conservation" title="Link to this heading">#</a></h3>
<p>Recall the conservation property specification:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pytest</span><span class="w"> </span><span class="kn">import</span> <span class="n">approx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">heat_is_conserved</span><span class="p">(</span><span class="n">u_old</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">u_new</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="n">vec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if heat is conserved.&quot;&quot;&quot;</span>
    <span class="n">lhs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u_new</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">rhs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">u_old</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="n">bc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h4>Exercise:<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>Similar to how we wrote a test function for the telescoping property, we can now implement
a property-based test for conservation using Hypothesis. Write a property-based test function
named <code class="docutils literal notranslate"><span class="pre">test_conservation_property</span></code> that checks if heat is conserved under arbitrary boundary conditions
at one time step.
Follow up: If this test passes, can we be certain that our solver conserves heat over multiple time steps? Why or why not?</p>
<p>Start with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_conservation_property</span><span class="p">(</span>
    <span class="n">u_old</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">kappa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bc</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u_old</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>

    <span class="n">step_heat_eqn</span><span class="p">(</span><span class="n">u_inout</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="n">bc</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">heat_is_conserved</span><span class="p">(</span><span class="n">u_old</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">bc</span><span class="p">),</span> <span class="s2">&quot;Conservation property violated&quot;</span>
</pre></div>
</div>
<p>and write out a <code class="docutils literal notranslate"><span class="pre">given</span></code> decorator that tests the conservation property. You’ll need to write a strategy that generates the initial state <code class="docutils literal notranslate"><span class="pre">u_old:</span> <span class="pre">vec</span></code>  as a list of floats.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: Implement test_conservation_property using Hypothesis</span>
</pre></div>
</div>
</div>
</div>
<p>Passing the one-step conservation property confirms that the solver preserves total heat under
insulated boundaries for a single update. In exact arithmetic and insulated boundaries at every
step, this one-step law would imply conservation over all steps by induction because conservation
is a <em><strong>loop invariant</strong></em>:</p>
<blockquote>
<div><p>loop invariant: a property that remains true before and after every iteration of the timestepping loop.</p>
</div></blockquote>
<p>In other words, total heat being conserved is an invariant of the update rule.
In real code, however, floating-point round-off and truncation errors in the
spatial and temporal discretizations can accumulate over time, breaking perfect invariance.
So, while the property shows the solver is formally conservative per step, true long-term
conservation depends on floating-point precision and numerical stability.</p>
</section>
</section>
<section id="symmetry">
<h3>Symmetry<a class="headerlink" href="#symmetry" title="Link to this heading">#</a></h3>
<p>We can test the symmetry property of the heat equation solver by checking if the solution remains
symmetric when the initial conditions are mirrored and boundary conditions are applied symmetrically.
To check this property, let’s first define a helper function to generate symmetric initial conditions.</p>
<p><strong>Feature Spotlight:</strong> The <code class="docutils literal notranslate"><span class="pre">st.builds()</span></code> method can be used to build complex data structures by
combining simpler strategies. Below, we use it to create symmetric arrays.</p>
<p>Notice how the strategy always generates symmetric lists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">symmetric_field</span><span class="p">(</span><span class="n">min_n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_n</span><span class="o">=</span><span class="mi">31</span><span class="p">):</span>
    <span class="c1"># Produce palindromic arrays</span>
    <span class="c1"># (odd length preferred for strict central symmetry)</span>
    <span class="c1"># Build half then mirror</span>
    <span class="n">half</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">floats_st</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="p">(</span><span class="n">min_n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">max_size</span><span class="o">=</span><span class="p">(</span><span class="n">max_n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">floats_st</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">builds</span><span class="p">(</span><span class="k">lambda</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">h</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">h</span><span class="p">)),</span> <span class="n">half</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>


<span class="n">symmetric_field</span><span class="p">()</span><span class="o">.</span><span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.0, 275.01402811786534, 0.0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@given</span><span class="p">(</span><span class="n">symmetric_field</span><span class="p">(),</span> <span class="n">dx_st</span><span class="p">,</span> <span class="n">kappa_st</span><span class="p">,</span> <span class="n">dt_st</span><span class="p">,</span> <span class="n">floats_st</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_symmetry_preservation</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
    <span class="c1"># This invariant is satisfied by the generator</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span>  <span class="c1"># keep a clear center</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">u0</span><span class="p">[:]</span>  <span class="c1"># copy to update</span>
    <span class="n">step_heat_eqn</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">bc</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="p">])</span>

    <span class="c1"># palindromic within FP tolerance</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_symmetry_preservation</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test completed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test completed
</pre></div>
</div>
</div>
</div>
</section>
<section id="monotonicity">
<h3>Monotonicity<a class="headerlink" href="#monotonicity" title="Link to this heading">#</a></h3>
<p>Diffusion smooths.</p>
<p>One way to express this intuition discretely is through monotonicity preservation:
if a temperature profile is nondecreasing at the start of a step, it should remain so after the update.
In other words, diffusion should not create new inversions.</p>
<p>This property is a discrete analogue of the maximum principle:
if a scheme never inverts local order, it can’t create new extrema either.</p>
<p>Below we encode the monotonicity property using Hypothesis.
We generate random nondecreasing initial profiles, advance one step, and check that ordering is preserved.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">is_monotone_nondecreasing</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">vec</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the list u is non-decreasing within a tolerance.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">atol</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">nondecreasing_lists</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uses `.map` to sort the list&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span>
        <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span>
    <span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">nondecreasing_lists_alternate</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate non-decreasing lists of floats strategy.</span>

<span class="sd">    Uses st.builds and a cumulative sum to build a non-decreasing list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span>
        <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span> <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span>
    <span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">floats_st</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">builds</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">b</span><span class="p">,</span> <span class="n">ds</span><span class="p">:</span> <span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ds</span><span class="p">[:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">))],</span> <span class="n">base</span><span class="p">,</span> <span class="n">deltas</span>
    <span class="p">)</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">u0</span><span class="o">=</span><span class="n">nondecreasing_lists</span><span class="p">(),</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt_st</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx_st</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_st</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_monotonicity_preserved_one_step</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
    <span class="n">assume</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">assume</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># stability condition</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">bc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># insulated</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">u0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">step_heat_eqn</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">is_monotone_nondecreasing</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="s2">&quot;Monotonicity violated&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_monotonicity_preserved_one_step</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test completed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test completed
</pre></div>
</div>
</div>
</div>
</section>
<section id="beware-of-assume">
<h3>Beware of <code class="docutils literal notranslate"><span class="pre">assume</span></code><a class="headerlink" href="#beware-of-assume" title="Link to this heading">#</a></h3>
<p>Avoid <a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/tutorial/adapting-strategies.html#assume-vs-filter">assume</a> if you can. It can be an inefficient way to explore the state space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assume</span><span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>since <code class="docutils literal notranslate"><span class="pre">kappa</span></code>, <code class="docutils literal notranslate"><span class="pre">dt</span></code> and <code class="docutils literal notranslate"><span class="pre">dx</span></code> are independently sampled, a large fraction of the search space may be invalid.</p>
<p>Instead adapt your generators to satisfy any necessary preconditions. Next we will discuss some more advanced strategy creation methods.</p>
</section>
</section>
<section id="advanced-test-case-generation-with-st-composite">
<h2>Advanced test-case generation with <code class="docutils literal notranslate"><span class="pre">st.composite</span></code><a class="headerlink" href="#advanced-test-case-generation-with-st-composite" title="Link to this heading">#</a></h2>
<p>Very frequently, we will want to combine multiple strategies to generate complex inputs that satisfy certain conditions.</p>
<p>for example: <code class="docutils literal notranslate"><span class="pre">assume(kappa</span> <span class="pre">*</span> <span class="pre">dt</span> <span class="pre">/</span> <span class="pre">(dx**2)</span> <span class="pre">&lt;</span> <span class="pre">0.5)</span>&#160; <span class="pre">#</span> <span class="pre">stability</span> <span class="pre">condition</span></code></p>
<p>There are two solutions here, both of which involve you drawing explicit values and making decisions or controlling further draws based on those values.</p>
<ol class="arabic simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">&#64;given(data=st.data,</span> <span class="pre">...)</span></code> and then <code class="docutils literal notranslate"><span class="pre">data.draw</span></code> in the test</p></li>
<li><p>Using the <code class="docutils literal notranslate"><span class="pre">st.composite</span></code> decorator to define a composite strategy.</p></li>
</ol>
<section id="st-data">
<h3><code class="docutils literal notranslate"><span class="pre">st.data()</span></code><a class="headerlink" href="#st-data" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">dts</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
        <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>


<span class="nd">@given</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">N</span><span class="o">=</span><span class="n">n_st</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx_st</span><span class="p">,</span> <span class="n">kappa</span><span class="o">=</span><span class="n">kappa_st</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_monotonicity_preserved_one_step_v2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

    <span class="c1"># Now we ensure that we create initial conditions of the right size!</span>
    <span class="n">u0</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">nondecreasing_lists</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">N</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span>

    <span class="c1"># Now we ensure that we pick a `dt` that always satisfies the stability condition</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">dts</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">0.49</span> <span class="o">*</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">kappa</span><span class="p">))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="c1"># stability condition is always satisfied by the `max_value` passed to `dts` strategy</span>
    <span class="k">assert</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.5</span>  
    <span class="n">bc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># insulated</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">u0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">step_heat_eqn</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">is_monotone_nondecreasing</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="s2">&quot;Monotonicity violated&quot;</span>


<span class="n">test_monotonicity_preserved_one_step_v2</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test completed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test completed
</pre></div>
</div>
</div>
</div>
</section>
<section id="st-composite">
<h3><code class="docutils literal notranslate"><span class="pre">st.composite()</span></code><a class="headerlink" href="#st-composite" title="Link to this heading">#</a></h3>
<p>This is a little more convoluted and not a great fit for our current problem but <code class="docutils literal notranslate"><span class="pre">composite</span></code> is extremely useful in real-world use-cases. The approach is very similar; the most important difference is that <code class="docutils literal notranslate"><span class="pre">composite</span></code> let’s you build strategies that take strategies as inputs (“higher-order strategies”)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>


<span class="k">def</span><span class="w"> </span><span class="nf">dxs</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span>
        <span class="n">min_value</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">max_value</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>


<span class="nd">@st</span><span class="o">.</span><span class="n">composite</span>
<span class="k">def</span><span class="w"> </span><span class="nf">meshes</span><span class="p">(</span><span class="n">draw</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">DrawFn</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">kappas</span><span class="o">=</span><span class="n">kappa_st</span><span class="p">,</span> <span class="n">dts</span><span class="o">=</span><span class="n">dts</span><span class="p">,</span> <span class="n">dxs</span><span class="o">=</span><span class="n">dxs</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">n_st</span><span class="p">):</span>
    <span class="c1"># `draw` is a function that lets you draw a concrete value</span>
    <span class="c1"># from a strategy like so:</span>
    <span class="n">kappa</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">kappas</span><span class="p">)</span>

    <span class="n">MIN_DT</span> <span class="o">=</span> <span class="mf">1e-6</span>

    <span class="c1"># now we pick a dx, dt such that the stability condition is *always* satisfied</span>
    <span class="c1"># 10% fudge factor to account for floating point resolution near MIN_DT</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">dxs</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.1</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">MIN_DT</span><span class="p">)))</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">dts</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="n">MIN_DT</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">0.49</span> <span class="o">*</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">kappa</span><span class="p">))</span>

    <span class="c1"># assert the postcondition</span>
    <span class="c1"># (always test your strategies!)</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># the need to return multiple values here suggests </span>
    <span class="c1"># this approach isn&#39;t a good for for this particular problem.</span>
    <span class="k">return</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">draw</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>


<span class="n">meshes</span><span class="p">()</span><span class="o">.</span><span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2.0896231194763653, 1.7334953900394796, Mesh(dx=3.0714195825772723, N=12))
</pre></div>
</div>
</div>
</div>
<p>Here is <a class="reference external" href="https://github.com/zarr-developers/zarr-python/blob/eb1b6e869115925f7b653e60bd542abd410a9a4e/src/zarr/testing/strategies.py#L237-L249">an example of a complex strategy</a> to generate Zarr arrays. This strategy is <em>public API</em> — <code class="docutils literal notranslate"><span class="pre">composite</span></code> is nice for building backward-compatible public strategies.</p>
</section>
</section>
<section id="what-we-just-did">
<h2>What we just did<a class="headerlink" href="#what-we-just-did" title="Link to this heading">#</a></h2>
<p>Property-based testing lets you codify computational, scientific, and mathematical properties as executable claims:</p>
<ul class="simple">
<li><p>We did prep-work: defined strategies for generating valid inputs.</p></li>
<li><p>We encoded properties: telescoping, conservation, symmetry, monotonicity</p></li>
<li><p>Hypothesis searched broad input spaces and shrank counterexamples when things went wrong.</p></li>
<li><p>This directly operationalizes the scientific method for software: state a hypothesis (property), attempt refutation (generation + shrinking), refine code or specs.</p></li>
</ul>
</section>
<section id="some-lessons-to-take-away">
<h2>Some lessons to take away<a class="headerlink" href="#some-lessons-to-take-away" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Property tests don’t replace other testing strategies.</p></li>
<li><p>Property tests pseudo-randomly sample the input search space. This means it is upon you to narrow the search space to “interesting” regions.</p></li>
<li><p>Simple properties are <strong>really</strong> effective.</p></li>
<li><p>Property testing suites are effectively an <strong>empirical specification</strong> of your program’s behaviour.</p></li>
<li><p>Your unit test is most likely a property test in disguise. Generalize them!</p></li>
<li><p>When you find a bug, construct a property test to catch it!</p></li>
</ol>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>John Hughes. How to specify it! <a class="reference external" href="https://research.chalmers.se/publication/517894/file/517894_Fulltext.pdf">[Paper]</a>, <a class="reference external" href="https://www.youtube.com/watch?v=G0NUOst-53U">[Talk]</a> ← highly recommended!</p></li>
<li><p><a class="reference external" href="https://www.hillelwayne.com/post/contract-examples/">Hillel Wayne. Finding property tests</a></p></li>
<li><p><a class="reference external" href="https://www.hillelwayne.com/post/cleverness/">https://www.hillelwayne.com/post/cleverness/</a></p></li>
<li><p><a class="reference external" href="https://fsharpforfunandprofit.com/posts/property-based-testing-2/#categories-for-properties">https://fsharpforfunandprofit.com/posts/property-based-testing-2/#categories-for-properties</a></p></li>
</ol>
</section>
<section id="looking-ahead">
<h2>Looking Ahead<a class="headerlink" href="#looking-ahead" title="Link to this heading">#</a></h2>
<p>In Chapter 5, we’ll step across the next rung of the rigor ladder: theorem proving—automating reasoning over all inputs within a finite domain and turning some of these properties into machine-checked contracts.</p>
<hr class="docutils" />
<p>R3Sw tutorial by Alper Altuntas (NSF NCAR). Guest lecture by <strong>Deepak Cherian</strong> (Earthmover). Sponsored by the BSSw Fellowship Program. © 2025.</p>
<p>Cite as: Alper Altuntas, Deepak Cherian, Adrianna Foster, Manish Venumuddula, and Helen Kershaw. (2025). <em>“Rigor and Reasoning in Research Software (R3Sw) Tutorial.”</em> Retrieved from <a class="reference external" href="https://www.alperaltuntas.com/R3Sw">https://www.alperaltuntas.com/R3Sw</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ch3_unit_testing.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 3: Unit Testing</p>
      </div>
    </a>
    <a class="right-next"
       href="ch5_theorem_proving.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 5: Bounded Formal Verification</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-property">What is a “property”?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#unit-tests-vs-property-based-tests">Unit tests vs. property-based tests:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-this-relates-to-chapter-2">How this relates to Chapter 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-hypothesis-library">The <code class="docutils literal notranslate"><span class="pre">Hypothesis</span></code> library</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hypothesis-to-the-rescue">Hypothesis to the rescue</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shrinking">Shrinking</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-your-own-strategies">Making your own strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-strategies">Combining strategies</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#other-approaches">Other approaches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-hypothesis">Controlling Hypothesis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-many-examples-are-generated">How many examples are generated</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#observability">Observability</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#back-to-the-heat-equation-solver">Back to the Heat Equation Solver</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scaffolding">Scaffolding</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#telescoping-property-what-goes-out-one-cell-must-go-in-the-next-cell">Telescoping Property : “what goes out one cell must go in the next cell”</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conservation">Conservation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Exercise:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#symmetry">Symmetry</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monotonicity">Monotonicity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beware-of-assume">Beware of <code class="docutils literal notranslate"><span class="pre">assume</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-test-case-generation-with-st-composite">Advanced test-case generation with <code class="docutils literal notranslate"><span class="pre">st.composite</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#st-data"><code class="docutils literal notranslate"><span class="pre">st.data()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#st-composite"><code class="docutils literal notranslate"><span class="pre">st.composite()</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-just-did">What we just did</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-lessons-to-take-away">Some lessons to take away</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#looking-ahead">Looking Ahead</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alper Altuntas, et al.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>